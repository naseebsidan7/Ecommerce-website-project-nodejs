<script>
    $(document).ready(function () {
        $('.pay-form').submit(function (e) {
            e.preventDefault();
            console.log('payform')
            var paymentMethod = $('input[name="payment"]:checked').val();
            if (paymentMethod == 'NetBanking') {
                console.log('razorpay')
                var formData = $(this).serialize();
                $.ajax({
                    url: "/createOrder",
                    type: "POST",
                    data: formData,
                    success: function (res) {
                        if (res.success) {
                            var options = {
                                "key": "" + res.key_id + "", // Enter the Key ID generated from the Dashboard
                                "amount": "" + res.amount + "", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                                "currency": "INR",
                                "name": "Orders",
                                "description": "Test Transaction",
                                "image": "/images/zel_logo.jpg",
                                "order_id": "" + res.order_id + "", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                                "handler": function (response) {
                                    // Submit the form to a separate route for further processing
                                    var form = $('.pay-form');
                                    var url = form.attr('action');
                                    var method = form.attr('method');
                                    $('<input>').attr({
                                        type: 'hidden',
                                        name: 'paymentMethod',
                                        value: paymentMethod
                                    }).appendTo(form);
                                    form.attr('action', '/checkout');
                                    form.attr('method', 'POST');
                                    form.unbind('submit').submit();
                                    form.attr('action', url);
                                    form.attr('method', method);
                                    location.href = `/viewOrderDetails?id=${orderId}`
                                },
                                "prefill": {
                                    "name": "" + res.name + "",
                                    "email": "" + res.email + "",
                                    "contact": "" + res.mobile + ""
                                },
                                "notes": {
                                    "address": "Razorpay Corporate Office"
                                },
                                "theme": {
                                    "color": "green"
                                }

                            };
                            var rzp1 = new Razorpay(options);
                            rzp1.on('payment.failed', function (response) {
                                alert("Payment Failed");
                            });

                            rzp1.open();
                        } else {
                            alert(res.msg);
                        }
                    }
                });
            }

            else {
                // Redirect to a separate route for non-Net Banking payments
                var form = $(this);
                var url = form.attr('action');
                var method = form.attr('method');
                $('<input>').attr({
                    type: 'hidden',
                    name: 'paymentMethod',
                    value: paymentMethod
                }).appendTo(form);
                form.attr('action', '/checkout');
                form.attr('method', 'POST');
                form.unbind('submit').submit();
                form.attr('action', url);
                form.attr('method', method);
            }
        });
    });

        function verifypayment(response, order) {
        console.log('ljhgoehveoihp')
        $.ajax({
            url: '/verify-payment',
            method: 'POST',
            data: {
                response,
                order
            },
            success: (response) => {
                if (response.status) {
                    const container = document.querySelector('.container');
                    container.style.display = 'none';
                    document.querySelector('.coupon-form').style.display = 'none';
                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed Successfully!',
                        showConfirmButton: false,
                        timer: 2000,
                    });

                    setTimeout(function () {
                        location.href = "/userorder";
                    }, 3000)

                } else {
                    alert('payment failed')
                }
            }

        })
    }

</script>